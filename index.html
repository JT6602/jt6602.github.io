<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="tower-dashboard-base" content="https://script.google.com/macros/s/AKfycbyz17Xpv8QY4ul-Abc7e40eME7Xzbw503R-sWliOsrYy4CKZmVULoW-S3he2OLPAantsw/exec" />
  <meta
    name="tower-dashboard-progress"
    content="https://script.google.com/macros/s/AKfycbyz17Xpv8QY4ul-Abc7e40eME7Xzbw503R-sWliOsrYy4CKZmVULoW-S3he2OLPAantsw/exec?sheet=UserData&token=1232435jvghfcgxdfgfcyguyuh1de2fr39u89y78gtghbijoqidwe2f089hyqdwefrjpihugy879"
  />
  <title>Tower Scavenger Hunt Control Room</title>
  <link rel="stylesheet" href="./assets/control-room.css" />
</head>
<body>
  <main>
    <header>
      <h1>The Tower Scavenger Hunt</h1>
      <p>
        Track your tower run across the basement and eleven upper floors of challenges. As puzzle content is finalized, replace
        the filler text inside
        each floor card. Progress is saved locally with cookies, so you can refresh or return to this page without losing your place.
      </p>
      <p>
        V0.8.0
      </p>
    </header>

    <section class="control-bar">
      <div class="progress-panel">
        <div class="progress-wrapper">
          <div class="progress-label">
            <span id="progressLabel">Hunt Progress</span>
            <span id="progressCount"></span>
          </div>
          <progress id="progressBar" class="progress-bar" value="0" max="11"></progress>
        </div>
        <div class="run-timer" id="teamTimer" aria-live="polite">Run time: –</div>
      </div>
      <div class="action-buttons">
        <button type="button" class="action-button" id="exportProgress">Copy Progress Code</button>
        <button type="button" class="action-button" id="importProgress">Import Progress</button>
        <button type="button" class="action-button" id="gmOverrideButton">GM Override</button>
        <button type="button" class="action-button" id="viewTowerMap">View Tower Map</button>
        <!-- <button type="button" class="action-button" id="showOtherProgress">Show Other Team Progress</button> -->
        <button type="button" class="reset-button" id="resetAll">Reset Progress</button>
      </div>
      <div class="status-message" id="statusMessage" role="status" aria-live="polite"></div>
    </section>

    <section class="stage" aria-live="polite">
      <article class="puzzle-view" id="puzzleView">
        <div class="waiting-aurora" id="waitingAurora" aria-hidden="true">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <div class="puzzle-lock-overlay" id="puzzleLock" aria-hidden="true">
          <div class="puzzle-lock-inner">
            <div class="puzzle-lock-sigil">
              <svg class="puzzle-lock-svg" viewBox="0 0 64 88" role="presentation" aria-hidden="true">
                <path class="puzzle-lock-body" d="M18 40h28c3.3 0 6 2.7 6 6v28c0 3.3-2.7 6-6 6H18c-3.3 0-6-2.7-6-6V46c0-3.3 2.7-6 6-6Z" />
                <path class="puzzle-lock-key" d="M32 54a4 4 0 1 1 0 8v8" />
                <path class="puzzle-lock-shackle" d="M22 40V28c0-5.5 4.5-10 10-10s10 4.5 10 10v12" />
              </svg>
            </div>
            <div class="puzzle-lock-label" id="puzzleLockMessage">Locked</div>
            <div class="puzzle-lock-actions">
              <button type="button" class="primary-action puzzle-lock-button" id="puzzleLockAction">Scan Code</button>
            </div>
          </div>
        </div>
        <div class="puzzle-hero">
          <h2 id="puzzleTitle">Loading Mission</h2>
          <div class="puzzle-meta-line" id="puzzleMeta"></div>
        </div>
        <div class="puzzle-body" id="puzzleBody"></div>
        <button type="button" class="primary-action puzzle-scan-button" id="scanButton" hidden>Scan QR Code</button>
        <form class="answer-form is-hidden" id="answerForm">
          <input
            type="text"
            id="answerInput"
            placeholder="Enter puzzle answer"
            aria-label="Puzzle answer"
            autocomplete="off"
            inputmode="text"
          />
          <button type="submit" class="primary-action" id="answerSubmit">Submit Answer</button>
        </form>
        <div class="answer-feedback" id="puzzleFeedback" aria-live="polite"></div>
      </article>
      <aside class="progress-track" id="progressPanel">
        <div class="platform-tag" id="platformTag">Platform: Detecting…</div>
        <h3>
          <span>Mission Queue</span>
          <div class="progress-label-extra" id="progressDescriptor"></div>
        </h3>
        <div class="progress-card" id="progressCard"></div>
      </aside>
    </section>
  </main>

  <section class="gm-sheet is-hidden" id="gmSheet" aria-labelledby="gmSheetTitle">
    <div class="gm-sheet-card">
      <header>
        <h1 id="gmSheetTitle">GM Reference Sheet</h1>
        <p>
          Private control log for game masters. Use these codes to validate player progress, issue team resets, or troubleshoot
          location locks. Keep this view secure—participant devices should never access this page.
        </p>
      </header>

      <div class="gm-grid" id="gmCells">
        <article class="gm-cell" data-category="start" aria-labelledby="gmStartHeading">
          <div class="gm-cell-header">
            <h2 id="gmStartHeading">Team Start Codes</h2>
            <p>Scroll to pick a team start badge. Click to display its QR.</p>
          </div>
          <div class="gm-cell-scroll" id="gmStartList" role="list"></div>
        </article>

        <article class="gm-cell" data-category="override" aria-labelledby="gmOverrideHeading">
          <div class="gm-cell-header">
            <h2 id="gmOverrideHeading">GM Override Codes</h2>
            <p>Use these if a team needs a reset or manual advance.</p>
          </div>
          <div class="gm-cell-scroll" id="gmOverrideList" role="list"></div>
        </article>

        <article class="gm-cell" data-category="location" aria-labelledby="gmLocationHeading">
          <div class="gm-cell-header">
            <h2 id="gmLocationHeading">Location QR Inventory</h2>
            <p>Tap a floor to project the onsite QR for teams.</p>
          </div>
          <div class="gm-cell-scroll" id="gmLocationList" role="list"></div>
        </article>
      </div>

      <section class="gm-section-footer" aria-labelledby="gmTeamOrdersHeading">
        <h2 id="gmTeamOrdersHeading">Team Mission Orders</h2>
        <p>
          Each team follows a unique tower path. Use this matrix to direct players if they lose their order or if you need to
          verify progress.
        </p>
        <div class="gm-orders" id="gmTeamOrders"></div>
      </section>
    </div>
  </section>

  <div class="gm-qr-overlay" id="gmQrOverlay" hidden aria-modal="true" role="dialog" aria-labelledby="gmQrOverlayTitle">
    <button type="button" class="gm-qr-overlay-close" id="gmQrOverlayClose" aria-label="Close QR projection"></button>
    <div class="gm-qr-overlay-inner">
      <div class="gm-qr-overlay-info">
        <h2 id="gmQrOverlayTitle"></h2>
        <p id="gmQrOverlaySubtitle"></p>
      </div>
      <div class="gm-qr-overlay-stage">
        <div class="gm-qr-overlay-code" id="gmQrOverlayCode"></div>
      </div>
    </div>
  </div>

  <div class="map-overlay" id="towerMapOverlay" hidden aria-modal="true" role="dialog" aria-labelledby="towerMapOverlayTitle">
    <button type="button" class="map-overlay-close" id="towerMapOverlayClose" aria-label="Close tower map"></button>
    <div class="map-overlay-inner">
      <h2 id="towerMapOverlayTitle">Tower Map</h2>
      <div class="map-overlay-body">
        <div class="tower-map map-overlay-content" id="towerMapOverlayContent" aria-label="Tower map overview">
          <div class="tower-map-levels" id="towerLevels"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="team-progress-overlay" id="teamProgressOverlay" hidden aria-modal="true" role="dialog" aria-labelledby="teamProgressOverlayTitle">
    <button type="button" class="team-progress-close" id="teamProgressOverlayClose" aria-label="Close team progress"></button>
    <div class="team-progress-dialog">
      <header class="team-progress-header">
        <h2 id="teamProgressOverlayTitle">Other Teams</h2>
        <p class="team-progress-status" id="teamProgressStatus"></p>
      </header>
      <div class="team-progress-body">
        <div class="team-progress-content" id="teamProgressContent" role="region" aria-live="polite"></div>
      </div>
    </div>
  </div>

  <div class="gm-override-overlay" id="gmOverrideOverlay" hidden aria-modal="true" role="dialog" aria-labelledby="gmOverrideTitle">
    <button type="button" class="gm-override-close" id="gmOverrideClose" aria-label="Close GM override"></button>
    <div class="gm-override-dialog">
      <header class="gm-override-header">
        <h2 id="gmOverrideTitle">GM Override</h2>
        <p id="gmOverrideSubtitle"></p>
      </header>
      <form id="gmOverrideForm" class="gm-override-form">
        <fieldset>
          <legend>Select Game State</legend>
          <div class="gm-override-options" id="gmOverrideOptions"></div>
        </fieldset>
        <div class="gm-override-actions">
          <button type="submit" class="primary-action" id="gmOverrideApply">Apply Selection</button>
          <button type="button" class="secondary-link" id="gmOverrideCancel">Cancel</button>
        </div>
      </form>
      <div class="gm-override-feedback" id="gmOverrideFeedback" aria-live="polite"></div>
    </div>
  </div>

  <div class="floor-transition" id="floorTransition" hidden aria-hidden="true">
    <div class="floor-transition-inner">
      <div class="floor-transition-track" aria-hidden="true">
        <div class="floor-transition-map-shell">
          <div class="floor-transition-map" id="floorTransitionMap"></div>
        </div>
        <div class="floor-transition-overlay">
          <div class="floor-transition-current" id="floorTransitionCurrent"></div>
          <div class="floor-transition-next" id="floorTransitionNext"></div>
        </div>
      </div>
      <div class="floor-transition-label" id="floorTransitionLabel"></div>
    </div>
  </div>

  <div class="answer-overlay" id="answerOverlay" hidden aria-live="assertive" aria-modal="true">
    <div class="answer-overlay-card">
      <div class="answer-overlay-stage answer-overlay-loading">
        <div class="answer-overlay-spinner" id="answerOverlaySpinner"></div>
        <p id="answerOverlayLoadingText">Checking answer…</p>
      </div>
      <div class="answer-overlay-stage answer-overlay-result">
        <h3 id="answerOverlayMessage"></h3>
        <p id="answerOverlaySubtext"></p>
      </div>
    </div>
  </div>

  <div class="start-overlay" id="startGameOverlay" hidden aria-modal="true" role="dialog" aria-labelledby="startGameTitle">
    <div class="start-overlay-card" id="startGameCard">
      <header class="start-overlay-header">
        <p class="start-overlay-team" id="startGameTeam"></p>
        <h2 id="startGameTitle">Tower Run Ready</h2>
      </header>
      <div class="start-overlay-body">
        <p id="startGameSummary"></p>
        <p class="start-overlay-note" id="startGameNote"></p>
      </div>
      <div class="start-overlay-actions">
        <button type="button" class="primary-action" id="startGameBegin">Begin Tower Run</button>
      </div>
    </div>
    <div class="start-overlay-effects" id="startGameEffects" aria-hidden="true">
      <span class="start-overlay-line start-overlay-line--left"></span>
      <span class="start-overlay-line start-overlay-line--right"></span>
      <span class="start-overlay-line start-overlay-line--top"></span>
      <span class="start-overlay-shout" id="startGameShout">HERE WE GO!!!</span>
    </div>
  </div>

  <div class="modal-backdrop" id="scannerModal" hidden>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="scannerTitle">
      <div class="scanner-shell" id="scannerShell">
        <h2 id="scannerTitle">Scan Mission QR</h2>
        <p id="scannerInstruction">Align the QR code inside the frame. We’ll automatically validate the code for this floor.</p>
        <video class="scanner-video" id="scannerVideo" playsinline></video>
        <div class="scan-status" id="scanStatus"></div>
        <div class="manual-entry">
          <input type="text" id="manualCode" placeholder="Enter code manually" autocomplete="off" inputmode="search" />
          <button type="button" class="primary-action" id="submitCode">Submit Code</button>
          <button type="button" class="secondary-link" id="cancelScan">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script defer src="./assets/control-room.js"></script>
</body>
</html>
