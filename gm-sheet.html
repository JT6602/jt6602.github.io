<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GM Reference Sheet — Tower Scavenger Hunt</title>
  <link rel="stylesheet" href="./assets/control-room.css" />
</head>
<body>
  <main>
    <header>
      <h1>The Tower Scavenger Hunt</h1>
      <p>
        Track your tower run across the basement and eleven upper floors of challenges. As puzzle content is finalized, replace
        the filler text inside
        each floor card. Progress is saved locally with cookies, so you can refresh or return to this page without losing your place.
      </p>
    </header>

    <section class="control-bar">
      <div class="progress-panel">
        <div class="progress-wrapper">
          <div class="progress-label">
            <span id="progressLabel">Hunt Progress</span>
            <span id="progressCount"></span>
          </div>
          <progress id="progressBar" class="progress-bar" value="0" max="11"></progress>
        </div>
      </div>
      <div class="action-buttons">
        <button type="button" class="action-button" id="exportProgress">Copy Progress Code</button>
        <button type="button" class="action-button" id="importProgress">Import Progress</button>
        <button type="button" class="reset-button" id="resetAll">Reset Progress</button>
      </div>
      <div class="status-message" id="statusMessage" role="status" aria-live="polite"></div>
    </section>

    <section class="stage" aria-live="polite">
      <article class="puzzle-view" id="puzzleView">
        <div class="waiting-aurora" id="waitingAurora" aria-hidden="true">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <div class="puzzle-hero">
          <h2 id="puzzleTitle">Loading Mission</h2>
          <div class="puzzle-meta-line" id="puzzleMeta"></div>
        </div>
        <div class="puzzle-body" id="puzzleBody"></div>
        <div class="stage-actions">
          <button type="button" class="primary-action" id="scanButton" disabled>Start QR Scan</button>
          <button type="button" class="secondary-link" id="reviewProgress">View Mission Queue</button>
        </div>
        <form class="answer-form is-hidden" id="answerForm">
          <input
            type="text"
            id="answerInput"
            placeholder="Enter puzzle answer"
            aria-label="Puzzle answer"
            autocomplete="off"
            inputmode="text"
          />
          <button type="submit" class="primary-action" id="answerSubmit">Submit Answer</button>
        </form>
        <div class="answer-feedback" id="puzzleFeedback" aria-live="polite"></div>
      </article>
      <aside class="progress-track" id="progressPanel">
        <div class="platform-tag" id="platformTag">Platform: Detecting…</div>
        <h3>
          <span>Mission Queue</span>
          <div class="progress-label-extra" id="progressDescriptor"></div>
        </h3>
        <div class="progress-card" id="progressCard"></div>
        <div class="tower-map" id="towerMap" aria-label="Tower map">
          <div class="tower-map-title">Tower Map</div>
          <div class="tower-map-levels" id="towerLevels"></div>
        </div>
      </aside>
    </section>

    <footer class="footer-note">
      Tip: want to stage new puzzle text? Update the placeholders here and commit the file to GitHub Pages. Cookie storage lasts
      one year and is scoped to this page.
  </footer>
  </main>

  <section class="gm-sheet is-hidden" id="gmSheet" aria-labelledby="gmSheetTitle">
    <div class="gm-sheet-card">
      <header>
        <h1 id="gmSheetTitle">GM Reference Sheet</h1>
        <p>
          Private control log for game masters. Use these codes to validate player progress, issue team resets, or troubleshoot
          location locks. Keep this view secure—participant devices should never access this page.
        </p>
      </header>

      <div class="gm-grid">
        <article class="gm-block" aria-labelledby="gmStartCodesHeading">
          <h2 id="gmStartCodesHeading">Team Start Codes</h2>
          <table>
            <thead>
              <tr>
                <th scope="col">Team</th>
                <th scope="col">Start QR Code</th>
              </tr>
            </thead>
            <tbody id="gmStartCodes"></tbody>
          </table>
        </article>

        <article class="gm-block" aria-labelledby="gmOverrideCodesHeading">
          <h2 id="gmOverrideCodesHeading">GM Override Codes</h2>
          <table>
            <thead>
              <tr>
                <th scope="col">Team</th>
                <th scope="col">Override Code</th>
              </tr>
            </thead>
            <tbody id="gmOverrideCodes"></tbody>
          </table>
        </article>

        <article class="gm-block" aria-labelledby="gmPuzzleCodesHeading">
          <h2 id="gmPuzzleCodesHeading">Location QR Inventory</h2>
          <table>
            <thead>
              <tr>
                <th scope="col">Floor</th>
                <th scope="col">QR Code</th>
              </tr>
            </thead>
            <tbody id="gmPuzzleCodes"></tbody>
          </table>
        </article>

        <article class="gm-block" aria-labelledby="gmQrGeneratorHeading">
          <h2 id="gmQrGeneratorHeading">On-Demand QR Codes</h2>
          <p class="gm-qr-description">
            Choose the codes you want to activate. Generated QR tiles appear below ready for screen share or download.
          </p>
          <div class="gm-qr-controls" id="gmQrControls" role="group" aria-label="QR code selection panel"></div>
          <div class="gm-qr-preview" id="gmQrPreview" aria-live="polite">
            <div class="gm-qr-empty" id="gmQrEmptyState">Select a code to generate its QR.</div>
          </div>
        </article>
      </div>

      <section class="gm-section-footer" aria-labelledby="gmTeamOrdersHeading">
        <h2 id="gmTeamOrdersHeading">Team Mission Orders</h2>
        <p>
          Each team follows a unique tower path. Use this matrix to direct players if they lose their order or if you need to
          verify progress.
        </p>
        <div class="gm-orders" id="gmTeamOrders"></div>
      </section>
    </div>
  </section>

  <div class="modal-backdrop" id="scannerModal" hidden>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="scannerTitle">
      <div class="scanner-shell" id="scannerShell">
        <h2 id="scannerTitle">Scan Mission QR</h2>
        <p id="scannerInstruction">Align the QR code inside the frame. We’ll automatically validate the code for this floor.</p>
        <video class="scanner-video" id="scannerVideo" playsinline></video>
        <div class="scan-status" id="scanStatus"></div>
        <div class="manual-entry">
          <input type="text" id="manualCode" placeholder="Enter code manually" autocomplete="off" inputmode="search" />
          <button type="button" class="primary-action" id="submitCode">Submit Code</button>
          <button type="button" class="secondary-link" id="cancelScan">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script defer src="./assets/vendor/qrcode.js"></script>
  <script defer src="./assets/control-room.js"></script>
</body>
</html>
